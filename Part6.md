Part6.md

# Давайте добавим игроков

### Cначала нарисуем пару прямоугольников.

Но чтобы было совсем интересно используем именно другой вариант рисовать прямоугольники. Мы же тут разнообразием занимаемся

```
function DrawPlayers()
for i,v in ipairs(Players) do
    love.graphics.setColor (1,0,0)
    love.graphics.rectangle( 'fill', v.x, v.y, v.size, v.size, 0, 0, 3)
end
```
Окей, я вас обманул, я не пишу этот блог прямо во время программирования. Что кстати жаль. Но мне только что (две недели назад) запретили использовать визуал студио, так что я сначала подепрессовал, а вот теперь взялся за сублайм. По крайней мере все компилируется без проблем. 

#### Итак, чего не хватает в предыдущем сегменте кода?

ПРально: голых ~~хоккеистов~~данных
```
PlayerA = {}
PlayerA.x = 1000
PlayerA.y = 150
PlayerA.size = 50
PlayerA.dx = 0
PlayerA.dy = 0
PlayerA.Puck = false
PlayerB = {}
PlayerB.x = 400
PlayerB.y = 450
PlayerB.size = 50
PlayerB.dx = 0
PlayerB.dy = 0
PlayerB.Puck = false
Players = {PlayerA, PlayerB}
```
Криво, не то слово. Тут совсем не хватает универсальности чтобы впендюрить две команды по 6 игроков, и еще запасных до кучи, но я и не говорил что я буду писать с первой строчки идеально.  
Заметили x,y - координаты, size-Размер, какой-то флаг связанный с шайбой и ВЕКТОР СКОРОСТИ? Пока пустой.

### Что должен делать хоккеист?  
Улыбаться на камеру, путать дно с горлышком и это, да, ловить ШАЙБУ!  
тут просто, если шайба в зоне досягаемости притяни её к себе и не дай двигаться. Еще раскрасим её для видности.
```
function CatchPuck(pl)
    if math.abs(pl.x - Puck.x) < 25 and math.abs( pl.y-Puck.y) < 25 then
        Puck.color = {1,0,0}
        Puck.dx = 0
        Puck.dy = 0
        Puck.x = pl.x
        Puck.y = pl.y
        pl.Puck = true
    end
end
```

### Вижу цель, не вижу препятствий

Ну и пусть хоккеист отправляет шайбу в ворота. В какие? Всё равно пусть будут правые.
```
function  LaunchPuck(pl)
    Puck.x = pl.x - 25
    Puck.dx,Puck.dy = GetVector (pl.x,pl.y,LeftGate.center.x,LeftGate.center.y)
end
```
Ну икс трогаем руками, чтобы шайба вышла из зоны "Поймай обратно", а дальше... назначаем шайбе вектор скорости такой чтобы от хоккеиста до ворот.
Вектор считается примитивно 
```
function GetVector (x1,y1,x2,y2)
local x = x2-x1
local y = y2-y1
return x,y
end
```
Да, и насчет руками: делаем себе пометку, "хоккеистам понадобится стейт-машина". Кладем пометку в туду-лист и забываем.

## Теперь смешиваем!

Единая функция упдате, чтобы всех игроков на поле обрабатывать
```
function UpdatePlayers(dt)
for i,v in ipairs(Players) do
    v.x = v.x + v.dx*dt
    v.y = v.y + v.dy*dt
    if v.Puck == true then 
        LaunchPuck (v)
        v.Puck = false
    else
    CatchPuck (v)
    end
end
end
```
Двигаем их (лол по нулям), потом кидаем шайбу если есть, а если нет - ловим. Не сходя с места. 

## И напоследок

Файл становится неприлично длинным даже для моего монитора, поэтому делим его на два. Всё что написали сегодня кладем в daman.lua, а в мейне пишем сверху `require "daman"`.   
Люблю интерпретируемые языки: нам нужен DA MAN и всё тут.